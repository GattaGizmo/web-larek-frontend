# Проектная работа "Веб-ларек"

WEB-ларёк — это интернет-магазин, специально разработанный для веб-разработчиков, предлагающий широкий ассортимент товаров, полезных для их работы. В проекте реализована функциональность просмотра товаров, добавления их в корзину и оформления заказа.

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

# Архитектура приложения WEB-LAREK

Приложение построено с использованием модели MVP. Код разделяет всю функциональность на следующие слои:
1) Представление: управляет отображением информации на пользовательском интерфейсе.
2) Слой данных: обеспечивает хранение и обработку информации, а также управление состоянием приложения.
3) Презентер: выполняет роль посредника между слоем представления и слоем данных, обеспечивая их взаимодействие.

# Данные и типы данных, используемых в приложении

## Главная страница приложения

### interface IPage {
    items: IProduct[]; // список товаров, которые отображаются на главной странице
    basket: number; // количество товаров, находящихся в корзине
}

## Карточка товара

### interface IProduct {
    id: string; // идентификатор товара
    title: string; // название товара
    category: string; // категория товара
    description: string; // описание товара
    image: string; // изображение товара
    price: number; // стоимость товара
}

## Данные для оформления заказа

### interface IOrder {
    payment: string; // способ оплаты
    address: string; // адрес
    email: string; // эл. почта
    phone: string; // телефон
    items: string[]; // вывод списка товаров
    totalPrice: number; // общая стоимость товаров
}

## Информация о корзине

### interface IBasket {
    items: IProduct[]; // список товаров, добавленных в корзину
    totalPrice: number; // общая стоимость товаров
}

**Типы данных карточки товара:**
1. type TProductList = Pick<IProduct, 'title' | 'image' | 'category' | 'price'> - при отображении на главной странице
2. type TProductModalInfo = Pick<IProduct, 'title' | 'price' | 'image' | 'category' | 'description'> - при отображении в модальном окне с подробной информацией о товаре

**Типы данных при выборе способа оплаты:**

type paymentMethod = 'online' | 'offline';

**Типы данных для оформления заказа (при выборе способа доставки и указания контактных данных пользователя):**
1. type TOrderDelivery = Pick<IOrder, 'payment' | 'address'>;
2. type TOrderUserData = Pick<IOrder, 'email' | 'phone' | 'address'>

**Типы данных корзины и при успешном заказе:**
1. type TBasket = Pick<IBasket, 'totalPrice'>;
2. type TSuccessOrder = Pick<IBasket, 'totalPrice'>;

# Базовые классы

### *Класс EventEmitter*
Класс EventEmitter является механизмом для управления событиями в приложении. Он предоставляет возможность подписки на события, отписки от них и уведомления подписчиков о возникновении событий. Ключевые методы класса включают:

*on* — для подписки на событие.

*off* — для отмены подписки на событие.

*emit* — для уведомления подписчиков о наступлении события.

*trigger* — генерирует событие с переданными аргументами, позволяя передавать его как обработчик в другие компоненты приложения.

Представленный класс используется в презентере для обработки событий и в других слоях приложения для генерации и передачи событий, что делает его важным инструментом для организации взаимодействия между компонентами всего приложения.

### *Класс API*
Этот класс реализует получение и отправку данных на сервер. Используются методы:

*get* — отправляет GET запрос на указанный адрес и возвращает ответ от сервера в виде объекта.

*post* — отправляет данные (в виде объекта) на сервер в формате JSON.

Конструктор **constructor(baseUrl: string, options: RequestInit = {})** - в него передаются основной URL сервера и необязательный объект с заголовками запросов.

# Слой данных (MODEL)

### *ProductData*
Указанный класс отвечает за обработку информации о товарах и за ее хранение. Его конструктор принимает экземпляр события-менеджера (брокера событий). Внутри класса определены следующие поля:

- products: IProduct[] — массив, содержащий объекты товаров;
- events: IEvents — экземпляр класса EventEmitter, используемый для генерации событий при изменении данных.

Используемые методы:
- getProductsList — возвращает весь список доступных товаров.
- getCard — возвращает объект товара по его идентификатору.
- setCardPreview — устанавливает (выбирает) карточку, которая будет отображена в модальном окне.

### *OrderData*

Этот класс предназначен для хранения и обработки данных о заказе. Он принимает два параметра в своём конструкторе: массив идентификаторов товаров и экземпляр брокера событий. В классе определены следующие поля:

- items: IProduct[] — массив товаров, входящих в заказ.
- paymentMethod: TPayment — способ оплаты.
- address: string — адрес для доставки.
- email: string — адрес электронной почты заказчика.
- phone: string — номер телефона заказчика.
- totalPrice: number — общая сумма заказа.
- events: IEvents — экземпляр класса EventEmitter, используемый для генерации событий при изменении данных.

Кроме того, класс предоставляет набор методов для работы с данными:

- getOrderData(): IOrder — возвращает информацию о заказе.
- setOrderData(order: IOrder): void — сохраняет данные заказа.
- getTotal(items: IProduct[]): number — вычисляет и возвращает общую сумму заказа.

В классе также реализованы дополнительные методы для валидации данных доставки и пользователя:
- checkOrderFormValidation() — проверяет валидность данных, введённых для оформления заказа.
- checkUserDataValidation() — проверяет валидность данных пользователя.

### *BasketData*

Этот класс управляет данными корзины товаров, обеспечивая логику добавления, удаления и подсчёта товаров. Конструктор принимает экземпляр брокера событий. Внутри класса определены следующие поля:

- items: IProduct[] — список товаров, добавленных пользователем в корзину.
- totalPrice: number — общая стоимость всех товаров в корзине.
- events: IEvents — экземпляр класса EventEmitter, используемый для генерации событий при изменении данных.

Используемые методы:

- addProduct(item: IProduct): void - добавляет новый товар в корзину.
- removeProduct(id: string): void - удаляет товар из корзины.
- getTotalPrice(): number - для подсчета общей стоимости заказа.
- getProductsCount(): number - для подсчета количества товаров в корзине.
- clear(): void - очищение корзины.

# Слой отображения (VIEW)

### *PageView*
Отвечает за отображение элементов на главной странице.
Поля класса:
- catalogue: HTMLElement; - каталог товаров.
- counter: HTMLElement; - отображения количества товаров, помещенных в корзину.
- wrapper: HTMLElement; - враппер страницы для предотвращения прокрутки страницы при открытии модального окна.
- basket: HTMLButtonElement; - кнопка корзины.

Используемые методы:

- set catalogue(items: HTMLElement[]) - устанавливает каталог товаров.
- set locked(value: boolean) - блок прокрутки страницы при открытии модального окна.
- set totalCount(value: number) - показывает общее количество товаров в корзине.

### *CardProductView*
Класс отображает карточки с информацией о продукте. Конструктор принимает темплейт и events: IEvents.
В полях класса описаны:
- id: string - идентификатор товара.
- category: HTMLSpanElement - к какой категории относится продукт.
- title: HTMLHeadingElement - название продукта.
- description: HTMLParagraphElement - описание.
- image: HTMLImageElement - изображение.
- price: HTMLSpanElement - цена.
- button: HTMLButtonElement - кнопка, с помощью которой можно добавить или удалить товар в/из корзины.

Используемые методы:
- get id: () => IProduct['id'] - возвращает id нужного продукта.
- setData(productData: IProduct): void - подставляет данные в элементы карточки товаров.
- set title(value: string): void- устанавливает название.
- set price(value: number): void - устанавливает значение цены.
- render(): HTMLElement - заполняет карточку данными и возвращает ее.

### *ModalView*

Данный класс реализует модальное окно. Использует методы для управления состоянием модального окна (открытие и закрытие). Также устанавливаются слушатели для того, чтобы модальное окно закрывалось по клику на крестик, оверлею или при нажатии Esc.

В поля класса вынесены:
- modal: HTMLElement — элемент модального окна.
- events: IEvents — экземпляр класса EventEmitter, используемый для генерации событий при изменении данных.

Используемые методы:
- openModal() - открывает модальное окно.
- closeModal() - закрывает модальное окно.
- setContent(content: HTMLElement): void - добавляет контент в модальное окно.
- render() - рендерит переданный контент, используя шаблоны.

Конструктор **constructor(container: HTMLFormElement, protected events: IEvents)** принимает селектор для нахождения модального окна в DOM и экземпляр брокера событий IEvents для работы с событиями.

### *ModalSuccessView и ModalFormView*

Эти классы расширяют базовый функционал класса Modal.

**ModalSuccessView** предназначен для отображения модального окна с сообщением об успешном оформлении заказа и включает:
- submitButtonSuccess: HTMLButtonElement - кнопка подтверждения и возвращения на главную ("За новыми покупками!").
- totalPrice: number - общая стоимость товаров.

Методы ModalSuccessView:
- set totalPrice() - выводит общую стоимость товаров.

**ModalFormView** предназначен для работы с модальным окном, которое содержит форму с полями ввода. 

Имеет поля:
- form: HTMLFormElement — элемент формы.
- inputList: HTMLInputElement[] - список инпутов формы.
- submitButton: HTMLButtonElement — кнопка для подтверждения.
- error: HTMLSpanElement - выводит ошибки валидации.

Методы ModalFormView:
- get form: HTMLElement - геттер, который получает элемент формы.
- setValid(isValid: boolean): void - устанавливает состояния кнопки.
- checkValidation(): boolean - проверяет валидацию полей формы.
- clearFormInputs() - очищает поля формы.

### *BasketView*
Класс предназначен для реализации корзины, в которой отображается список добавленных в нее товаров, кнопка оформления заказа и итоговая стоимость.

Имеет поля:
- totalItems: number - количество товаров, которые помещены в корзину.
- totalPrice: HTMLSpanElement- общая стоимость товаров.
- button: HTMLButtonElement- кнопка оформления заказа.

Методы BasketView:

- setTotalItems(value: number): number - предназначен для отображения общего количество товаров в корзине.
- set totalPrice: (value: number) => void - устанавилвает общую стоимость товаров.

# Презентер/Слой коммуникации (PRESENTER)

Взаимодействие между представлением и данными описано в файле index.ts, который выполняет роль презентера. Этот файл управляет событиями, генерируемыми через брокер событий и обрабатываемыми соответствующими обработчиками. В index.ts сначала создаются необходимые экземпляры классов, а затем настраивается обработка событий.

***События, связанные с изменениями данных (генерируются классами модели данных):***

totalPrice:changed — изменение итоговой суммы заказа.

basketCount:changed — изменение счетчика товаров в корзине на главной странице.

product:previewClear — необходимость очистки данных выбранной карточки продукта для отображения в модальном окне.

***События, вызванные взаимодействием пользователя с интерфейсом (генерируются классами представления):***

product:select — выбор карточки для отображения в модальном окне.

product:submit — добавление продукта в корзину.

basket:open — открытие модального окна корзины.

basket:delete — выбор карточки для удаления из корзины.

basket:submit — создание заказа из выбранных продуктов.

orderDeliveryData:open — открытие модального окна оформления заказа с адресом и способом оплаты.

paymentMethod:select — выбор способа оплаты.

orderAddress:input — изменение данных в форме с адресом пользователя.

orderAddress:valid — валидация адреса пользователя.

orderDeliveryData:submit — отправка данных адреса и способа оплаты.

orderUserData:open — открытие модального окна оформления заказа с номером телефона и электронной почтой пользователя.

orderPhoneNumber:input — изменение данных в форме с номером телефона.

orderPhoneNumber:valid — валидация номера телефона.

orderEmail — изменение данных в форме электронной почты.

orderEmail:valid — валидация электронной почты.

orderUserData:submit — отправка данных номера телефона и электронной почты.

success:submit — переход на главную страницу магазина после успешного заказа.