# Проектная работа "Веб-ларек"

WEB-ларёк — это интернет-магазин, специально разработанный для веб-разработчиков, предлагающий широкий ассортимент товаров, полезных для их работы. В проекте реализована функциональность просмотра товаров, добавления их в корзину и оформления заказа.

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

# Архитектура приложения WEB-LAREK

Приложение построено с использованием модели MVP. Код разделяет всю функциональность на следующие слои:
1) Представление: управляет отображением информации на пользовательском интерфейсе.
2) Слой данных: обеспечивает хранение и обработку информации, а также управление состоянием приложения.
3) Презентер: выполняет роль посредника между слоем представления и слоем данных, обеспечивая их взаимодействие.

# Данные и типы данных, используемых в приложении

## Главная страница приложения

### interface IPage {
    items: IProduct[]; // список товаров, которые отображаются на главной странице
    basket: number; // количество товаров, находящихся в корзине
}

### interface IAPIResponse {
    items: IProduct[]; // массив продуктов, полученных по API
}

### interface IProduct {
    id: string; // идентификатор товара
    title: string; // название товара
    category: string; // категория товара
    description: string; // описание товара
    image: string; // изображение товара
    price: number; // стоимость товара
    picked: boolean; // флаг, указывающий, выбран ли продукт (например, добавлен ли он в корзину)
}

### interface IOrder {
    payment: string; // способ оплаты
    address: string; // адрес
    email: string; // эл. почта
    phone: string; // телефон
    items: string[]; // вывод списка товаров
    total: number; // общая стоимость товаров
}

### interface IOrderForm {
    payment: string; // метод оплаты
    address: string; // адрес доставки
    email: string; // электронная почта
    phone: string; // телефон
}

### interface IOrderPayment {
    payment: string; // метод оплаты
    address: string; // адрес доставки
}

### interface IUserContacts {
    email: string; // электронная почта пользователя
    phone: string; // телефон пользователя
}

### interface IBasket {
    items: HTMLElement[]; // список элементов корзины на странице
    totalPrice: number; // общая цена товаров в корзине
}

### interface IBasketActions {
    onClick: (event: MouseEvent) => void; // обработчик клика по элементам корзины
}

### interface IBasketWithProduct {
    id: string; // id продукта
    index: number; // индекс товара в корзине
    title: string; // название товара
    price: number; // цена товара
    category: string; // категория товара
    description: string; // описание товара
    image: string; // изображение товара
    picked: boolean; // флаг, указывающий, был ли товар выбран (добавлен в корзину)
}

### interface IAppData {
    basket: IProduct[]; // массив товаров
    catalog: IProduct; // каталог продуктов
    order: IOrder; // информация о заказе
    formErrors: ErrorsInForm; // ошибки в форме заказа
}

### interface ICardProduct {
    picked: boolean; // флаг, выбран ли товар
    id: string; // идентификатор продукта
    category: string; // категория товара
    title: string; // название товара
    image: string; // изображение товара
    price: number; // цена товара
    description: string; // описание товара
}

### interface ICardProductActions {
    onClick: (event: MouseEvent) => void; // обработчик клика по карточке товара
}

### interface IForm {
    valid: boolean; // флаг, показывающий, валидна ли форма
    errors: string[]; // список ошибок формы
}

### interface IModal {
     content: HTMLElement; // содержимое модального окна
}

### interface ISuccessOrder {
     description: number; // описание успеха оформления заказа (списанная сумма)
}

### interface ISuccessOrderActions {
    onClick: (event: MouseEvent) => void; // обработчик клика по кнопке
}

**Тип данных Category:**

export type Category = 'софт-скил' | 'другое' | 'дополнительное' | 'кнопка' | 'хард-скил'; - определяет возможные категории.

**Типы данных CategoryChoice:**

export type CategoryChoice = { [key in Category]: string; }; - объект, в котором ключами являются категории из типа Category, а значениями — строки, представляющие описание или название каждой категории.

**Типы данных ErrorsInForm:**
export type ErrorsInForm = Partial<Record<keyof IOrder, string>>; - для ошибок в форме.

# Базовые классы

### *Класс EventEmitter*
Класс EventEmitter служит механизмом для управления событиями в приложении, обеспечивая связь между Model и View. Он предоставляет возможность подписки на события, отписки от них и уведомления подписчиков о возникновении событий. EventEmitter выполняет роль связующего звена, которое позволяет компонентам представления (View) реагировать на изменения данных в модели (Model), а также отправлять события обратно в модель, чтобы она обновляла свои данные. Ключевые методы класса включают:

*on* — для подписки на событие.

*off* — для отмены подписки на событие.

*emit* — для уведомления подписчиков о наступлении события.

*trigger* — генерирует событие с переданными аргументами, позволяя передавать его как обработчик в другие компоненты приложения.

Таким образом, EventEmitter помогает в реализации архитектуры MVP, где Презентер (Presenter) использует этот класс для обработки событий и их передачи между Model и View. View генерирует события, такие как действия пользователя (например, клик по кнопке), а Model реагирует на них, обновляя данные, что в свою очередь приводит к обновлению интерфейса (через View).

### *Класс API*
Этот класс реализует получение и отправку данных на сервер. Используются методы:

*get* — отправляет GET запрос на указанный адрес и возвращает ответ от сервера в виде объекта.

*post* — отправляет данные (в виде объекта) на сервер в формате JSON.

Конструктор **constructor(baseUrl: string, options: RequestInit = {})** - в него передаются основной URL сервера и необязательный объект с заголовками запросов.

### *Класс Component*
Этот класс является абстрактным и предназначен для работы с DOM-элементами, а также для создания компонентов, которые могут использовать наследование и расширение.

### *Класс Model*
Абстрактный класс, который служит базой для создания моделей с данными.

# Слой данных (MODEL)

### *ProductData*
Класс ProductData представляет собой модель, которая расширяет базовый класс Model<IProduct>. Он предназначен для работы с данными о продукте и предоставляет возможность взаимодействовать с ними, а также обрабатывать связанные события. Класс ProductData используется для хранения данных о продукте и предоставляет базовую структуру для работы с продуктами в контексте событийной системы.
С помощью этой модели можно управлять состоянием продукта (например, выбран ли он) и взаимодействовать с системой событий для отслеживания изменений. Внутри класса определены следующие поля:

- picked: Булевое значение, которое указывает, выбран ли продукт (например, добавлен ли он в корзину).
- id: Строковое значение, которое представляет уникальный идентификатор продукта.
- description: Описание продукта, представленное строкой.
- image: URL изображения продукта.
- title: Название продукта, представлено строкой.
- category: Категория, к которой принадлежит продукт, представлена строкой.
- price: Цена продукта, может быть числом или null (если цена не указана).

В конструкторе вызывается родительский конструктор super(picked, events), который инициализирует свойства родительского класса, а затем присваивает this.events значение, переданное в параметре.

### *AppData*

Класс AppData является моделью для управления данными приложения, связанными с каталогом продуктов, корзиной покупок и оформлением заказов. Он включает логику работы с товарами, заказами, валидацией форм и взаимодействием с другими компонентами приложения через систему событий. Этот класс играет ключевую роль в бизнес-логике приложения, координируя работу с данными о товарах, корзине и заказах, и взаимодействуя с другими частями интерфейса через события. В классе определены следующие поля:

- catalog: Массив объектов ProductData, представляющих товары, доступные в каталоге.
- order: Объект, который хранит информацию о текущем заказе пользователя, включая товары, общую сумму, адрес, способ оплаты, email и телефон.
- basket: Массив объектов ProductData, который содержит все товары, добавленные в корзину покупок.
- formErrors: Объект ошибок формы, который хранит ошибки, связанные с валидацией данных пользователя, например, при оформлении заказа или ввода контактной информации.

Кроме того, класс предоставляет набор методов для работы с данными:

- basketItemsLength(): Возвращает количество товаров в корзине.
- setItems(): Обновляет список товаров в заказе, добавляя в order.items идентификаторы товаров из корзины.
- addToBasket(item: ProductData): Добавляет товар в корзину.
- removeFromBasket(id: string): Удаляет товар из корзины по его идентификатору.
- clearBasket(): Очищает корзину.
- totalPrice(): Возвращает общую стоимость всех товаров в корзине.
- setCatalogue(products: IProduct[]): Обновляет каталог товаров, создавая новые экземпляры ProductData и добавляя их в каталог. Также вызывает событие catalog:changed, чтобы уведомить другие компоненты о смене каталога.
- resetPicked(): Сбрасывает все товары в каталоге, устанавливая их свойство picked в false.
- validateOrder(): Проверяет, заполнены ли все обязательные поля заказа (адрес и способ оплаты). Возвращает true, если ошибок нет, и обновляет объект formErrors.
- validateContacts(): Проверяет, заполнены ли обязательные поля контактной информации (email и телефон). Возвращает true, если ошибок нет, и обновляет объект formErrors.
- validation(field: keyof IOrderForm, value: string): Обновляет значение поля в объекте заказа и выполняет валидацию контактных данных и данных заказа. Если данные корректны, эмиттируются события contacts:ready и order:ready.
- resetOrder(): Сбрасывает данные текущего заказа, очищая все поля.

### *ContactsData*

Класс ContactsData представляет собой форму для работы с контактными данными пользователя, которая расширяет базовый класс Form<IUserContacts>. Он предназначен для взаимодействия с элементами формы, которая может содержать информацию о контактных данных пользователя, и для обработки связанных с этим событий.
В конструкторе вызывается конструктор родительского класса super(container, events), который выполняет инициализацию контейнера и событий.


# Слой отображения (VIEW)

### *PageView*
Класс Page представляет собой компонент страницы, отвечающий за отображение и управление элементами на веб-странице, такими как каталог товаров, счетчик товаров в корзине и сам контейнер страницы. Он взаимодействует с другими компонентами приложения через систему событий и обеспечивает изменение и обновление контента на странице. 
constructor(container: HTMLElement, events: IEvents): Конструктор класса, который инициализирует ссылки на элементы страницы и привязывает обработчик события нажатия на корзину (_basket).

Поля класса:
- _catalogue: Ссылка на элемент DOM, который содержит каталог товаров (представлен как элемент с классом .gallery).
- _counter: Ссылка на элемент DOM, который отображает счетчик количества товаров в корзине (представлен как элемент с классом .header__basket-counter).
- _wrapper: Ссылка на основной обертку страницы (представлен как элемент с классом .page__wrapper).
- _basket: Ссылка на элемент DOM, который представляет корзину (представлен как элемент с классом .header__basket).

Используемые методы:

- set catalogue(items: HTMLElement[]) - устанавливает каталог товаров.
- set locked(value: boolean) - блок прокрутки страницы при открытии модального окна.
- set totalCount(value: number) - показывает общее количество товаров в корзине.

### *CardProductView*
Класс CardProductView представляет собой компонент, отображающий карточку товара на веб-странице. Он управляет отображением различных данных о товаре, таких как категория, название, изображение, цена, а также состоянием кнопки (например, доступности или недоступности). Класс также предоставляет возможность обработки событий, связанных с карточкой товара. Конструктор инициализирует ссылки на элементы карточки товара (категория, название, изображение, цена, кнопка) и привязывает обработчик событий для кнопки.

В полях класса описаны:
- _category: Ссылка на DOM-элемент, отображающий категорию товара.
- _title: Ссылка на DOM-элемент, отображающий название товара.
- _image: Ссылка на DOM-элемент изображения товара (представляет собой HTMLImageElement).
- _price: Ссылка на DOM-элемент, отображающий цену товара.
- _data: Хранит данные товара, соответствующие интерфейсу ICardProduct (например, информация о товаре).
- _button: Ссылка на кнопку действия в карточке товара (например, кнопка добавления в корзину).

Используемые методы:
- set picked(value: boolean): Сеттер для свойства picked, который управляет состоянием кнопки (доступна или нет). Если кнопка не отключена, то она будет отключена, если value истинно.
- set id(value: string): Сеттер для идентификатора товара, который устанавливает атрибут data-id у контейнера карточки товара. Этот атрибут может быть использован для хранения уникального идентификатора товара в DOM.
- get id(): string: Геттер для получения идентификатора товара, извлекая его из атрибута data-id контейнера карточки товара.
- set category(value: Category): Сеттер для установки категории товара. Устанавливает текст категории и добавляет соответствующий класс для визуального отображения выбранной категории товара.
- set title(value: string): Сеттер для установки названия товара.
- get title(): string: Геттер для получения названия товара из текстового содержимого элемента.
- set image(value: string): Сеттер для установки изображения товара. Формирует полный путь до изображения, добавляя базовый URL.
- set price(value: number | null): Сеттер для установки цены товара. Если цена задана, то она отображается, в противном случае выводится текст "Бесценно". Если цена не указана, кнопка может быть отключена.

### *CatalogueItem*

Класс CatalogueItem является расширением класса CardProductView и представляет собой элемент каталога товаров. Он наследует все функциональности карточки товара, предоставляемой CardProductView, но с дополнительной настройкой для использования в контексте каталога товаров. 

### *CatalogueItemPreview*

Класс CatalogueItemPreview расширяет класс CardProductView и представляет собой карточку товара, но с добавлением описания товара. Этот класс используется для отображения предварительного просмотра товара, где помимо основных данных, также может отображаться текстовое описание товара.

### *ModalView*

Данный класс реализует модальное окно. Использует методы для управления состоянием модального окна (открытие, закрытие, рендеринг). constructor(container: HTMLElement, events: IEvents): В конструкторе инициализируются два элемента:
_closeButton: Кнопка закрытия модального окна. Она ищется в контейнере с помощью метода ensureElement, который гарантирует, что элемент существует в DOM.
_content: Контейнер для содержимого модального окна.

Используемые методы:
- openModal() - открывает модальное окно.
- closeModal() - закрывает модальное окно.
- setContent(content: HTMLElement): void - добавляет контент в модальное окно.
- render(content: HTMLElement): HTMLElement - рендерит переданный контент, используя шаблоны.

### *SuccessView*

Является представлением для отображения сообщения об успешном заказе. 
constructor(blockName: string, container: HTMLElement, actions?: ISuccessOrderActions): В конструкторе инициализируются два элемента:
_description: Элемент, в котором будет отображаться описание успешного завершения заказа.
_button: Кнопка закрытия (или любой другой элемент для выполнения действия).

Метод:
- set description(value: number): Этот метод используется для установки описания. В тексте используется номер, который указывает сумму, списанную с аккаунта (количество синапсов).

### *FormView* 

Класс Form представляет собой абстрактную форму для работы с данными. В конструкторе инициализируются следующие элементы:
_submit: Кнопка отправки формы.
_errors: Элемент, в который будет выводиться информация о ошибках формы.

Имеет поля:
- _submit: Кнопка отправки формы (кнопка с типом submit).
- _errors: Элемент, в который будет выводиться информация о ошибках формы.

Методы:
- onInputChange: Этот метод вызывается каждый раз, когда пользователь изменяет значение в поле ввода формы. Он эмиттирует событие input:change, передавая имя поля и его новое значение.
- set valid(value: boolean): Метод для активации или деактивации кнопки отправки формы. Если форма невалидна, кнопка отправки становится неактивной (disabled).
- set errors(value: string): Метод для отображения ошибок в форме. 
- render: Метод рендеринга, который обновляет состояние формы. 

### *BasketView*
Класс BasketView представляет компонент корзины покупок на веб-странице. Он управляет отображением элементов корзины, общей стоимости, а также состоянием кнопки "Оформить заказ".

Имеет поля:
- _items: Элемент, представляющий список товаров в корзине.
- _totalPrice: Элемент, отображающий общую стоимость корзины.
- _button: Кнопка для оформления заказа.

Методы BasketView:

- set items(items: HTMLElement[]): Этот метод обновляет содержимое корзины, заменяя все элементы в контейнере на переданные items. Также управляется состояние кнопки. Если корзина пуста, кнопка становится неактивной.
- set totalPrice(total: number): Метод для обновления отображения общей стоимости корзины.
- disableButton(): Метод, который деактивирует кнопку оформления заказа.
- indexReset(): Метод сбрасывает индексы товаров в корзине, пересчитывая их заново.

### *BasketWithProduct*
Класс BasketWithProduct представляет элемент корзины, который отображает информацию о товаре, такую как индекс, название, цену, а также предоставляет кнопку для удаления товара из корзины.

Имеет поля:
- _index: Элемент, представляющий индекс товара в корзине.
- _title: Элемент, представляющий название товара.
- _price: Элемент, отображающий цену товара.
- _button: Кнопка, которая при клике удаляет товар из корзины

Методы:

- set index(value: number): Метод устанавливает индекс товара и отображает его в соответствующем элементе.
- set title(value: string): Метод устанавливает название товара и отображает его в соответствующем элементе.
- set price(value: number): Метод устанавливает цену товара. Если цена указана, то она отображается, иначе отображается текст "Бесценно".

# Презентер/Слой коммуникации (PRESENTER)

Взаимодействие между представлением и данными описано в файле index.ts, который выполняет роль презентера. Организует логику взаимодействия с интернет-магазином, включая загрузку продуктов, управление корзиной, оформление заказов и валидацию форм. Система событий позволяет гибко обрабатывать пользовательские действия и динамически обновлять интерфейс.

***События, связанные с изменениями данных:***

catalog:changed: Обновляет отображение каталога на странице, создавая новые карточки товаров для каждого элемента в каталоге.

orderFormErrors:change: Проверяет поля формы, такие как оплата и адрес, и обновляет состояние валидации.

contactsFormErrors:change: Обновляется информация о валидности формы и ошибках.

input:change: Используется для валидации введенных данных и обновления состояния приложения.

order:submit: Рассчитывает общую стоимость заказа и отображает форму ввода контактных данных.

contacts:submit: Отправляет данные на сервер для оформления заказа. После успешного ответа очищает корзину и сбрасывает данные заказа.

order:success: Показывает сообщение об успешном оформлении заказа с итоговой суммой.

***События, вызванные взаимодействием пользователя с интерфейсом:***

modal:close: Событие срабатывает, когда модальное окно закрывается.

card:open: Открывает модальное окно.

card:toBasket: Обновляет корзину и количество товаров, а также закрывает модальное окно.

basket:open: Открывает корзину покупок.

basket:remove: Удаление товара из корзины.

basket:order: Открывает форму заказа.

order:submit: Отправляет данные на сервер и запускает процесс оформления заказа.

contacts:submit: Срабатывает при отправке контактной формы для завершения оформления заказа.